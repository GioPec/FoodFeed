<center>
    
    <h4>Filter by:</h4>
    
    
    <%= form_tag discover_path, :method => :post, :multipart => true do %>
            <label>Course</label>
            <%= select(:recipe, :course,    [['', ''],
                                            ['Breakfast', 'Breakfast'],
                                            ['Appetizer', 'Appetizer'], 
                                            ['Finger Food', 'Finger Food'],
                                            ['First course', 'First course'],
                                            ['Soup', 'Soup'],
                                            ['Pizza', 'Pizza'],
                                            ['Second course', 'Second course'],
                                            ['Bread', 'Bread'],
                                            ['Side course', 'Side course'],
                                            ['Salad', 'Salad'],
                                            ['Sauce', 'Sauce'],
                                            ['Snack', 'Snack'],
                                            ['Drink', 'Drink'],
                                            ['Dessert', 'Dessert'],
                                            ['Fruit', 'Fruit']]) %>
            <label>Diet</label>
            <%= select(:recipe, :category, [['', ''],
                                            ['Gluten Free', 'Gluten Free'],
                                            ['Ketogenic', 'Ketogenic'], 
                                            ['Vegetarian', 'Vegetarian'],
                                            ['Lacto-Vegetarian', 'Lacto-Vegetarian'],
                                            ['Ovo-Vegetarian', 'Ovo-Vegetarian'],
                                            ['Vegan', 'Vegan'],
                                            ['Pescetarian', 'Pescetarian'],
                                            ['Paleo', 'Paleo'],
                                            ['Primal', 'Primal'],
                                            ['Whole30', 'Whole30']]) %>
            <label>Intolerances</label>
            <%= select(:recipe, :intolerance, [['', ''],
                                            ['Dairy', 'Dairy'],
                                            ['Egg', 'Egg'], 
                                            ['Gluten', 'Gluten'],
                                            ['Grain', 'Grain'],
                                            ['Peanut', 'Peanut'],
                                            ['Seafood', 'Seafood'],
                                            ['Sesame', 'Sesame'],
                                            ['Shellfish', 'Shellfish'],
                                            ['Soy', 'Soy'],
                                            ['Sulfite', 'Sulfite'],
                                            ['Tree Nut', 'Tree Nut'],
                                            ['Wheat', 'Wheat']]) %>
            <label>Price</label>
            <%= select(:recipe, :price, [['', ''],
                                            ['1', 1],
                                            ['2', 2],
                                            ['3', 3], 
                                            ['4', 4],
                                            ['5', 5]]) %>
            <label>Difficulty</label>
            <%= select(:recipe, :difficulty, [['', ''],
                                            ['1', 1],
                                            ['2', 2],
                                            ['3', 3], 
                                            ['4', 4],
                                            ['5', 5]]) %>
            <button type="submit">Filter</button>
    <% end %>
    <% if @filters.length!=0 %>
        <b>Filtering by: </b><% @filters.each do |f| %>
                        <%= f %> <br>
                        <% end %>
    <% end %>
    <hr>

    <h1>Discover</h1>

    <% if @recipes.length==0 %>
        No recipe found :(
    <% end %>
    <% @recipes.each do |r| %>

        <div style="border: solid black 1px">

            <% difference = (DateTime.now.utc - r.created_at).to_i %>
            <% if difference < 60 %>
            <%= difference.to_s + "s"%>
            <% elsif difference < 60*60 %>
            <%= (difference/60).to_s + "m"%>
            <% elsif difference < 60*60*24 %>
            <%= (difference/(60*60)).to_s + "h" %>
            <% elsif difference < 60*60*24*7 %>
            <%= (difference/(60*60*24)).to_s + "g" %>
            <% elsif difference < 60*60*24*7*52 %>
            <%= (difference/(60*60*24*7)).to_s + "w" %>
            <% else %>
            <%= (difference/(60*60*24*7*52)).to_s + "y" %>
            <% end %>
            
            <% u = User.find(r.user_id) %>  <!--trovo l'utente che ha scritto la ricetta-->
            <% url="/users/" + r.user_id.to_s %>    <!--creo il link-->
            <h2><span>
                <% if u.profile_img.attached? %>
                    <img src="<%= url_for(u.profile_img) %>" height="40px">
                <% else %>
                    <img src="<%= u.img %>" height="40px">
                <% end %>
                <a href=<%= url %>><%= u.username %></a>  <!--username cliccabile - titolo-->
            </span></h2>

            <% url_recipe="/users/" + r.user_id.to_s + "/recipes/" + r.id.to_s %>    <!--creo il link-->
            <a href=<%= url_recipe %>>
                <img src="<%= url_for(r.image) %>" height=400px>
            </a><br>

            <h2><%= r.title %></h2>
            
            <p><%= r.n_likes %> likes</p>
            <p><%= r.n_comments %> comments</p>
            
        </div>

    <% end %>
</center>