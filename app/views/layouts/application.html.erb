<!DOCTYPE html>
<html>
  <head>
    <title>Foodproject</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>

    <script>
    //popup
    function showNotifications() {
      var popup2 = document.getElementById("myPopup2");
      popup2.classList.toggle("show");
    }
  </script>
  </head>

  <body>
    <% if user_signed_in? %>
      Logged in as <%= current_user.email%> [<%= link_to "Profile", user_path(current_user.id) %> 
        - <%= link_to 'Logout', destroy_user_session_path, :method => :delete %>] - <%= link_to 'Daily recipe', dailyrecipe_path %>
         - <%= link_to 'Discover', discover_path %> <% if current_user.role!="U" %> - <%= link_to 'Users', users_path %> <% end %>
          -  <%= link_to 'Contact', contact_path %> - <%= link_to 'Favourites', favourites_path(current_user.id) %>
            -  <%= link_to 'Top', top_path %> - <%= link_to 'Homepage', homepage_path %> - 

      

      <%= form_tag search_path, :method => 'get' do %>
          <%= text_field_tag :search, params[:search] %>
          <%= submit_tag "Search", :name => nil %>
      <% end %>

    <% end %>
    <% flash.each do |key, value| %>
      <div class="alert alert-<%= key %>"><%= value %></div>
    <% end %>
  <br>
  <br>
  <br>
  <br>
  <br>
  <div class="popup" onclick="showNotifications()"><%= Notification.where(user_id: current_user.id).length %> notifications unread
        <span class="popuptext" id="myPopup2">
          <% Notification.where(user_id: current_user.id).each do |n| %>
            <% sender=User.find(n.sender_id)%>
            <% if n.notification_type=="like" %>
              <a href="/users/<%= n.user_id %>/recipes/<%= n.recipe_id %>"><%= sender.username %> liked your recipe</a><br>
            <% elsif n.notification_type=="comment" %> 
              <a href="/users/<%= n.user_id %>/recipes/<%= n.recipe_id %>"><%= sender.username %> commented your recipe</a><br>
            <% else %> 
              <a href="/users/<%= n.sender_id %>"><%= sender.username %> started following you</a><br>
            <% end %>
          <% end %>
        </span>
      </div>

    <%= yield %>
  
  </body>
  

</html>
