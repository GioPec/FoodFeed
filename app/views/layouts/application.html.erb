<!DOCTYPE html>
<html>
  <head>
    <title>Foodproject</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag 'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_pack_tag 'application', 'data-turbolinks-track': 'reload' %>

    <script>
    //popup
    function showNotifications() {
      var popup2 = document.getElementById("myPopup2");
      popup2.classList.toggle("show");
    };
  </script>
  </head>

  <body>
    <% if user_signed_in? %>
      Logged in as <%= current_user.email%> [<%= link_to "Profile", user_path(current_user.id) %> 
        - <%= link_to 'Logout', destroy_user_session_path, :method => :delete %>] - <%= link_to 'Daily recipe', dailyrecipe_path %>
         - <%= link_to 'Discover', discover_path %> <% if current_user.role!="U" %> - <%= link_to 'Users', users_path %> <% end %>
          -  <%= link_to 'Contact', contact_path %> - <%= link_to 'Favourites', favourites_path(current_user.id) %>
            -  <%= link_to 'Top', top_path %> - <%= link_to 'Homepage', homepage_path %> - 

      <div class="popup" onclick="showNotifications()">ðŸ”” <%= Notification.where(user_id: current_user.id, read: false).length %> notifications unread
        <span class="popuptext" id="myPopup2">
          <% Notification.where(user_id: current_user.id).last(5).each do |n| %>
            <% if n.read==false %>
              <% sender=User.find(n.sender_id)%>
              <% if n.notification_type=="like" %>
                <%= link_to sender.username+" liked your recipe", remove_notification_path(n.id) %><br>
              <% elsif n.notification_type==" comment" %>
                <%= link_to sender.username+" commented your recipe",  remove_notification_path(n.id) %><br>
              <% else %> 
                <%= link_to sender.username+" followed you", remove_notification_path(n.id) %><br>
              <% end %>
            <% else %>
              <% sender=User.find(n.sender_id)%>
              <% if n.notification_type=="like" %>
                <div style="background-color: #D3D3D3"><a href="/users/<%= n.user_id %>/recipes/<%= n.recipe_id %>"><%= sender.username %> liked your recipe</a></div>
              <% elsif n.notification_type=="comment" %> 
                <div style="background-color: #D3D3D3"><a href="/users/<%= n.user_id %>/recipes/<%= n.recipe_id %>"><%= sender.username %> commented your recipe</a></div>
              <% else %> 
                <div style="background-color: #D3D3D3"><a href="/users/<%= n.sender_id %>"><%= sender.username %> started following you</a></div>
              <% end %>
            <% end %>
          <% end %>
          <%= link_to "Show all notifications", notifications_path(current_user.id) %><br>
        </span>
      </div>

      <%= form_tag search_path, :method => 'get' do %>
          <%= text_field_tag :search, params[:search] %>
          <%= submit_tag "Search", :name => nil %>
      <% end %>
    <% end %>
    <% flash.each do |key, value| %>
      <div class="alert alert-<%= key %>"><%= value %></div>
    <% end %>
  

    <%= yield %>
  
  </body>
  

</html>
